<odoo>
    <data>
        <record id="project_book_period_tree" model="ir.ui.view">
            <field name="name">project book period</field>
            <field name="model">project.book_period</field>
            <field name="arch" type="xml">
                <tree editable="top">
			<!--
                        <field name="project_id" optional="hide"/>
			-->
                        <field name="reference_period"/>
                        <field name="period_project_book" sum="Total"/>
                </tree>                      
            </field>                       
        </record>

        <record id="book_employee_distribution_tree" model="ir.ui.view">
            <field name="name">book employee distribution</field>
            <field name="model">project.book_employee_distribution</field>
            <field name="arch" type="xml">
                <tree editable="top">
			<!--
                        <field name="project_id" optional="hide"/>
			-->
                        <field name="employee_id"/>
                        <field name="book_factor" sum="Total"/>
                </tree>                      
            </field>                       
        </record>

        <record id="book_employee_distribution_period_tree" model="ir.ui.view">
            <field name="name">book employee distribution period</field>
            <field name="model">project.book_employee_distribution_period</field>
            <field name="arch" type="xml">
                <tree>
                        <field name="project_id"/>
                        <field name="rel_is_book_manually_computed"/>
                        <field name="rel_book_comment"/>
                        <field name="employee_id"/>
			<field name="project_book_period_id"/>
			<!--
                        <field name="reference_period"/>
			-->
                        <field name="period_project_book" optional="show"/>
                        <field name="book_factor" optional="show"/>
			<field name="period_project_book_employee" sum="Total"/>
                </tree>                      
            </field>                       
        </record>

        <record id="project_book_employee_distribution_period_action" model="ir.actions.act_window">
		<field name="name">Distribution du book projet/salarié/année</field>
                <field name="res_model">project.book_employee_distribution_period</field>
                <field name="view_mode">tree</field>
        </record>

        <record id="view_project_book_employee_distribution_period_search" model="ir.ui.view">
            <field name="name">Distribution du book projet/salarié/année</field>
            <field name="model">project.book_employee_distribution_period</field>
            <field name="arch" type="xml">
                <search string="Search">
		    <field name="employee_id" string="Employé" filter_domain="['|', ('employee_id.name', 'ilike', self), ('employee_id.first_name', 'ilike', self)]"/>
                    <field name="project_id" string="Projet"/>
                    <field name="reference_period" string="Année de référence"/>


                    <filter string="Les projets dont je suis DM" name="own_projects" domain="[('project_id.project_director_employee_id.user_id.id', '=', uid)]"/>
                    <filter string="Mon book" name="my_book" domain="[('employee_id.user_id', '=', uid)]"/>
                    <filter string="Book calculé manuellement" name="is_book_manually_computed" domain="[('rel_is_book_manually_computed', '=', True)]"/>
                    <filter string="Book calculé automatiquement" name="is_book_manually_computed_false" domain="[('rel_is_book_manually_computed', '=', False)]"/>

                    <filter string="Cette année" name="this_year" domain="[('reference_period', '=', context_today().strftime('%Y'))]"/>
                    <filter string="L'an dernier" name="previous_year" domain="[('reference_period', '=', (context_today() + relativedelta(years=-1)).strftime('%Y'))]"/>

                    <group expand="0" string="Group By">
                        <filter string="Employé" name="employe" context="{'group_by': 'employee_id'}"/>
                        <filter string="Année de référence" name="reference_period" context="{'group_by': 'reference_period'}"/>
                        <filter string="Projet" name="project" context="{'group_by': 'project_id'}"/>
                    </group>
                </search>
            </field>
        </record>

	<menuitem name="Distribution du book" id="project_book_distribution_menu" parent="project.menu_main_pm" action="project_book_employee_distribution_period_action"/>
   </data>
</odoo>
