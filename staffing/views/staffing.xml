<odoo>
  <data>
   <record model="ir.ui.view" id="staffing.need_tree">
      <field name="name">Besoins de staffing</field>
      <field name="model">staffing.need</field>
      <field name="arch" type="xml">
        <tree editable="top" expand="1">
          <field name="name" optional="hide"/>
          <field name="project_id" options="{'no_quick_create': True}"/>
	  <field name="job_id" optional="show"/>
	  <field name="skill_id" optional="show"/>
	  <field name="considered_employee_ids" optional="show" widget="many2many_tags"/>
	  <field name="begin_date" optional="show"/>
	  <field name="end_date" optional="show"/>
	  <field name="nb_days_needed" optional="show"/>
	  <field name="state" optional="show"/>
          <field name="staffed_employee_id" optional="hide"/>
		<button icon="fa-eye" title="Voir" name="open_record" type="object" class="oe_highlight"/>
        </tree>
      </field>
    </record>

   <record model="ir.ui.view" id="staffing.need_form">
      <field name="name">Besoins de staffing</field>
      <field name="model">staffing.need</field>
      <field name="arch" type="xml">
        <form>
		<header>
			<field name="state" widget="statusbar" statusbar_visible="wait,open,done" readonly="1"/>
		</header>
		<!--
		<widget name="web_ribbon" title="Annulée" modifiers="{'invisible':[('state', '=', 'canceled')]}"/>
		-->
		<group>
                  <group>
			  <field name="name"/>
			  <field name="project_id" modifiers="{'no_quick_create': True, &quot;readonly&quot;: [[&quot;state&quot;, &quot;in&quot;, [&quot;done&quot;, &quot;canceled&quot;]]]}" />
			  <field name="job_id" modifiers="{&quot;readonly&quot;: [[&quot;state&quot;, &quot;in&quot;, [&quot;done&quot;, &quot;canceled&quot;]]]}" />
			  <field name="skill_id" modifiers="{&quot;invisible&quot;: [[&quot;state&quot;, &quot;in&quot;, [&quot;done&quot;, &quot;canceled&quot;]]]}" />
			  <field name="considered_employee_ids" widget="many2many_tags" modifiers="{&quot;invisible&quot;: [[&quot;state&quot;, &quot;in&quot;, [&quot;done&quot;, &quot;canceled&quot;]]]}" />
  		  </group>
		  <group>
			    <label for="begin_date" string="Dates de début/fin"/>
					    <div name="dates" class="o_row">
						    <field name="begin_date" widget="daterange" options="{'related_end_date': 'end_date'}" />
						<i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow"/>
						<field name="end_date" widget="daterange" options="{'related_start_date': 'begin_date'}" />
					    </div>
			  <field name="nb_days_needed" modifiers="{&quot;invisible&quot;: [[&quot;state&quot;, &quot;in&quot;, [&quot;done&quot;, &quot;canceled&quot;]]]}" />
			  <field name="staffed_employee_id"/>
		  </group>
		</group>
			  <field name="staffing_proposal_ids" mode="kanban" modifiers="{&quot;invisible&quot;: [[&quot;state&quot;, &quot;in&quot;, [&quot;done&quot;, &quot;canceled&quot;]]]}">
				  <kanban>
					  <field name="id"/>
					  <field name="employee_id"/>
					<templates>
						<t t-name='kanban-tooltip'>
							<div class="oe_kanban_tooltip">
								<field name="employee_staffing_wishes" />
							</div>
						</t>
						<t t-name="kanban-box">
							<div class="oe_kanban_global_click o_kanban_record_has_image_fill o_hr_kanban_record">
                            					<field name="employee_image" class="o_kanban_image_fill_left d-block" preview_image="employee_image" widget="background_image" options="{'zoom': true, 'zoom_delay': 1000}"/>
                            <div class="oe_kanban_details">
                               <div class="o_kanban_record_top">
                                   <div class="o_kanban_record_headings">
                                       <strong class="o_kanban_record_title">
					       <field name="employee_id"/>
					</strong>
					<field name="employee_job" class="o_kanban_record_subtitle"/>
				   </div>
				</div>
				<span>Dispo : <field name="employee_availability"/> j. / <field name="staffing_need_nb_days_needed"/></span>
				<field name="ranked_proposal" widget="progressbar" class="o_progressbar_complete.o_progress_blue"/>
			    </div>
							</div>
						</t>
					</templates>
				  </kanban>
				  <tree>
					  <field name="employee_id"/>
					  <field name="employee_job_id" optional="hide"/>
					  <field name="employee_availability" optional="show"/>
					  <field name="employee_skill_ids"  widget="many2many_tags" optional="show"/>
					  <field name="ranked_proposal" optional="show"/>
					  <field name="employee_staffing_wishes" optional="show"/>
					  <field name="ranked_employee_availability" optional="hide"/>
					  <field name="ranked_employee_skill" optional="hide"/>
					  <field name="ranked_employee_explicit_voluntary" optional="hide"/>
					  <field name="ranked_employee_worked_on_proposal" optional="hide"/>
					  <field name="ranked_employee_wished_on_need" optional="hide"/>
				</tree>
			  </field>
        </form>
      </field>
    </record>


    <record model="ir.ui.view" id="staffing.need_search">
        <field name="name">staffing.need.search</field>
        <field name="model">staffing.need</field>
        <field name="arch" type="xml">
           <search string="Besoins de staffing">
                    <field name="project_id" string="Projet"/>
                    <field name="state" string="Statut"/>
		    <!--
                    <filter string="Mes actions commerciales" name="assigned_to_me"
                        domain="[('user_ids', 'in', uid)]"
                        help="Actions commerciales qui m'ont été assignées"/>
			  </field>
			-->
                    <separator/>
                    <filter name="state_open" string="Besoins ouverts" domain="[('state', '=', 'open')]"/>
                    <group expand="0" string="Group By">
                        <filter string="Statut" name="group_state" context="{'group_by': 'state'}"/>
                        <separator/>
                        <filter string="Projet" name="group_project" context="{'group_by': 'project_id'}"/>
                    </group>
           </search>
        </field>
    </record>

    <record id="staffing.need" model="ir.actions.act_window">
        <field name="name">Besoins de staffing</field>
        <field name="res_model">staffing.need</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{
                    'search_default_state_open': 1,
                    'search_default_group_project' : 1,
            }</field>
    </record>

    <menuitem name="Staffing" id="staffing.staffing_root" groups="staffing_admin"/> 
    <menuitem name="Besoins de staffing" id="staffing.staffing_need" parent="staffing.staffing_root" action="staffing.need"/> 
  </data>
</odoo>
