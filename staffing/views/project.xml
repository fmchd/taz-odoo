<odoo>
	<data>
	    <record id="view_project_pivot_search" model="ir.ui.view">
		<field name="name">account.analytic.line.select</field>
		<field name="model">account.analytic.line</field>
		<field name="priority">1</field>
		<field name="arch" type="xml">
		    <search string="Search Analytic Lines">
			<field name="employee_id"/>
			<field name="date"/>
			<field name="project_id"/>
			<filter string="Date" name="week" date="date"/>
			<filter name="mine" string="My Timesheets" domain="[('user_id', '=', uid)]"/>
			<filter name="history_3months" string="Hstorique de 3 mois" domain="[('date','&gt;=', ((context_today()-datetime.timedelta(days=91)).strftime('%%Y-%%m-%%d')))]"/>
			<group string="Group By..." expand="0" name="groupby">
			    <filter string="Category" name="group_category" context="{'group_by': 'category'}"/>
			    <filter string="Employee" name="group_employee" context="{'group_by': 'employee_id'}"/>
			    <filter string="Project" name="group_project" context="{'group_by': 'project_id'}"/>
			    <filter string="Date (par semaine)" name="group_date" context="{'group_by': 'date:week'}"/>
			</group>
		    </search>
		</field>
	    </record>

	    <record id="view_project_pivot" model="ir.ui.view">
		<field name="name">account.analytic.line.pivot</field>
		<field name="model">account.analytic.line</field>
		<field name="arch" type="xml">
		    <pivot string="Analytic Items" sample="1">
			<field name="date" type="col" interval="month"/>
			<field name="date" type="col" interval="week"/>
			<field name="category" type="col" />
			<field name="employee_id" type="row"/>
			<field name="unit_amount" type="measure" string="Jours"/>
			<field name="amount" type="measure"/>
		    </pivot>
		</field>
	    </record>

            <record id="view_forecast_pivot" model="ir.ui.view">
                <field name="name">account.analytic.line.pivot</field>
                <field name="model">account.analytic.line</field>
                <field name="arch" type="xml">
                    <pivot string="Analytic Items" sample="1">
                        <field name="date" type="col" interval="month"/>
                        <field name="date" type="col" interval="week"/>
                        <field name="project_id" type="row"/>
                        <field name="unit_amount" type="measure" string="Jours"/>
                        <field name="amount" type="measure"/>
                    </pivot>
                </field>
	    </record>

	   <record model="ir.ui.view" id="staffing.project_tree">
	      <field name="name">Project</field>
	      <field name="model">project.project</field>
	      <field name="arch" type="xml">
		<tree>
		  <field name="number"/>
		  <field name="name"/>
		  <field name="partner_id"/>
		  <field name="stage_id"/>
		</tree>
	      </field>
	    </record>

	   <record model="ir.ui.view" id="staffing.project_form">
	      <field name="name">Project</field>
	      <field name="model">project.project</field>
	      <field name="priority">55</field>
	      <field name="arch" type="xml">
		<form>
			<field name="company_id" invisible="1"/>
			<field name="analytic_account_id" invisible="1"/>
			<sheet string="Project">
				<div class="oe_button_box" name="button_box">
				    <button class="oe_stat_button" type="object" name="open_project_pivot_timesheets" icon="fa-calendar">
					<div class="o_form_field o_stat_info">
					   <span class="o_stat_text">Pointage/prévisionnel</span>
					    <!--
					    <span class="o_stat_value">
						<field name="balance" widget='monetary'/>
					    </span>
					    -->
					</div>
				    </button>
				</div>

				<widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
				<field name="active" invisible="1"/>
				<div class="oe_title">
					<h1 class="d-flex flex-row">
				    		<field name="number" readonly="1" nolabel="1" class="me-1"/>
				    		<field name="name" class="o_text_overflow" placeholder="Intitulé du projet"/>
					</h1>
                    		</div>
				    <group>
					<group>
					    <field name="partner_id"/>
					    <field name="stage_id"/>
					    <field name="probability"/>
					    <field name="order_amount"/>
					    <field name="margin_target"/>
					    <field name="margin_landing" widget="progressbar"/>
					    <field name="margin_text"/>
					</group>
					<group>
					    <field name="project_director_employee_id" attrs="{'readonly':[('active','=',False)]}" />
					    <label for="date_start" string="Dates de début/fin"/>
					    <div name="dates" class="o_row">
						<field name="date_start" widget="daterange" options="{&quot;related_end_date&quot;: &quot;date&quot;}"/>
						<i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow"/>
						<i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [('date_start', '=', False), ('date', '=', False)]}"/>
						<field name="date" widget="daterange" options="{&quot;related_start_date&quot;: &quot;date_start&quot;}"/>
					    </div>
					</group>
				   </group>
				<notebook>
					<page string="Besoins/staffing">
						<field name="staffing_need_ids" context="{'default_project_id':active_id}">
							<tree editable="top">
								  <field name="name" optional="hide"/>
								  <field name="job_id" optional="show"/>
								  <field name="skill_id" optional="show"/>
								  <field name="considered_employee_ids" optional="show" widget="many2many_tags"/>
								  <field name="begin_date" optional="show"/>
								  <field name="end_date" optional="show"/>
								  <field name="nb_days_needed" optional="show"/>
								  <field name="state" optional="show"/>
								  <field name="staffed_employee_id" optional="show"/>
									<button icon="fa-eye" title="Voir" name="open_record" type="object" class="oe_highlight"/>
							</tree>
						</field>
					</page>
					<page name="description" string="Description">
						<group>
							<group>
					    		    <field name="description" options="{'resizable': false}" placeholder="Description du projet..."/>
							    <field name="remark"/>
							</group>
						</group>
					</page>
					<page string="Jalons de facturation">
						<field name="milestone_ids" context="{'default_project_id':active_id}" >
							<tree decoration-danger="is_deadline_exceeded">
								<field name="can_be_marked_as_done" invisible="1"/>
								<field name="name"/>
								<field name="deadline"/>
								<field name="is_reached"/>
								<field name="reached_date"/>
								<field name="is_deadline_exceeded" invisible="1"/>
							</tree>
						</field>
					</page>
					<page string="Info de facturation">
						<group>
							<group>
							    <field name="is_purchase_order_received"/>
							    <field name="purchase_order_number"/>
							    <field name="outsourcing"/>
							    <field name="billed_amount"/>
							    <field name="payed_amount"/>
							</group>
							<group>
					    			<field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
					    			<field name="analytic_account_id"/>
							</group>
						</group>
					</page>
				</notebook>
			</sheet>
		<div class="oe_chatter">
                    <field name="message_follower_ids" options="{'post_refresh':True}" help="Follow this project to automatically track the events associated to tasks and issues of this project." groups="base.group_user"/>
		    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
		</form>
	      </field>
	    </record>

	<record id="seq_project" model="ir.sequence">
		<field name="name">Preject number sequence</field>
		<field name="code">project.project</field>
		<field name="active">True</field>
		<field name="prefix">%(y)s</field>
		<field name="number_increment">1</field>
			<!--	DO NOT UPDATE THE SEQUENCE NUMBER NEXT AFTER CREATION #TODO : move to sequence dedicated XML and set "no update" flag
				<field name="number_next">1</field>
			-->
		<field name="padding">3</field>
		<field name="implementation">standard</field>
	</record>

    <record id="staffing.project_action" model="ir.actions.act_window">
        <field name="name">Projets</field>
        <field name="res_model">project.project</field>
        <field name="view_mode">tree,form</field>
	<field name="view_ids" eval="
                            [
                            (5, 0, 0),
                            (0, 0, {'view_mode': 'tree', 'view_id': ref('staffing.project_tree')}),
                            (0, 0, {'view_mode': 'form', 'view_id': ref('staffing.project_form')}),
                              ]" />
    </record>

     <record id="forecast_action" model="ir.actions.server">
          <field name="name">Forecast</field>
          <field name="model_id" ref="model_project_project"/>
          <field name="state">code</field>
          <field name="code">action =  env.get('project.project').open_forecast_pivot_timesheets()</field>
     </record>

    <menuitem name="Projets" id="staffing.project_menu" parent="staffing.staffing_root" action="staffing.project_action"/>
    <menuitem name="Plan de charge à 3 mois" id="staffing.forecast_menu" parent="staffing.staffing_root" action="staffing.forecast_action"/>


	</data>
</odoo>
